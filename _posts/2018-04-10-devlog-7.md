---
title: 'devlog #7'
author: marco.lizza
layout: post
permalink: "/devlog-7/"
comments: true
categories: 
  - devlog
tags: 
  - indiedev
  - gamedev
  - game-design
  - 30daydev
---
# Prologue

It's been really a while since the last time I wrote a blog entry. Well, it's been a while also since the last time I dedicated myself to a *gamedev* project. Many real-life duties and shenanigans kept my time and attention from being spent on development (in general). Now it seems that the storm has passed, and I can recall myself to more fun duties. And what's better than a [#30daydev](https://itch.io/jam/30daydev) project to re-train my indiedev muscles?

I'm not going to elaborate a lot each. It's going to be much like a diary-like (mega)entry.

## Day #0 (2018-04-10)

Occurred to me that I never developed my own *Pac-Man* clone. Need to fix this ASAP. It will be a cute exercise in basic *AI* development and group behaviour.

[LÖVE](https://love2d.org/) finally reached a new milestone, and the *v11.0* version has been released. I will definitely use this engine/framework for this project.

Scanning once again through [Jamey Pittman’s "Pac-Man Dossier"](http://www.gamasutra.com/view/feature/3938/the_pacman_dossier.php). Will use it as a reference for the development. That's quite a lot of information to digest.

## Day #1 (2018-04-11)

For study purposes, I (partially) watched [Jamey Pittman's *Perfect Game*](https://www.youtube.com/watch?v=AuoH0vz3Mqk). It's astonishing the tactics and the strategies that have been discovered and implemented over the years. A casual watcher could think the player to be without any clue, because of the weird movements and pauses. Not even close.

The ghosts' AIs are the single most important part of the game. Problem is that if I intend to create a proper *remake* I would also be implementing their faulty behaviours (such as, for example, Pinky's and Inky's when Pac-Man is facing upward).

There are a lot of [minor details](https://www.youtube.com/watch?v=l7-SHTktjJc) that could be easily missed, such as the fact that the ghosts and Pac-Man have different speeds when turning a corner (the ghosts appear to "wait" a bit... but how long is this "bit"?). Should the *kill-screen* worth implementing? Will the *safe areas* emerge automatically if the AI is properly implemented?

Tomorrow I'll start and draw some placeholder sprites in order to set the game area up.

## Day #2 (2018-04-23)

Still studying [Jamey Pittman’s "Pac-Man Dossier"](http://www.gamasutra.com/view/feature/3938/the_pacman_dossier.php). The sheer amount of detail in this document is amazing. The lack of a "real" path-finding algorithm (e.g. Dijkstra) is neat. With a simple euclidean distance calculation and by setting a priority to movement directions once can be easily fooled that a shortest-route algorithm is applied. Can't wait to implement this as see it in action!

Started by drawing the maze graphic (using the Pico-8's palette, which I like very much).

![Maze Graphic (v0)](/assets/images/pacman-map-v0.png)

I proceeded in tweaking the colors a bit. I'm not displeased by the result.

![Maze Graphic (v1)](/assets/images/pacman-map-v1.png)

Tomorrow I'll be drawing the sprites. I'm wondering whether the pellets and fruits should be rendered as *sprites* or as layered tiles over the background tiles. I suppose the original game used tiles, since sprites where not for free and very limited. Also, handling them as tiles seems convenient and easy enough.

## Day #3 (2018-04-13)

Ditched sprites to work a bit more with the maze graphics. I've been separating the proper maze map from the pellets (which are now on a separate layer). Also, I added a "support" layer to flag the cells and encode specific behaviours.

![Maze Graphic w/ Layers (v2)](/assets/images/pacman-map-v2.png)

To answer yesterday's question, I checked the [Namco Pac-man arcade board specifications](https://en.wikipedia.org/wiki/Namco_Pac-Man). The amount of available sprites is very limited (eight) and their size is 16x16 pixels. The rest of the display is generated as an 8x8 tiles background. We can safely conclude that the pellets are rendered by means tiles, while the fruits are sprites (in addition to Pac-Man and the ghosts).

I'm debated on the most practical way to represent the maze flags. Of course, the maze itself is small and a source-code encoded representation won't imply any difficulty. Nevertheless, I'll prefer a more sleek and faster-to-handle way. Perhaps a raster bitmap color-representation?

Now that the maze is (mostly) complete, I should really prepare some sprites...

## Day #4/#5 (2018-04-14/15)

Deeply busy with real-life duties, weekends aren't easy when it comes to development.

Worked a little more to some initial sprites. I decided that, for the moment being, I'll be using some placeholder ones (8x8 colored blocks that mark the sprite direction and status) while I'm working on some 16x16 ones. I could easily use the real arcade sprite (they are more than available on the net) but I never liked them... and it feels just too much of a rip-off to me.

Tomorrow is time for the maze rendering.

In the meantime, the first [LÖVE](https://love2d.org/) hotfix (*v11.1*) has been released. It's more than welcome.

## Day #6 (2018-04-16)

Back in the days of home-computer conversions from the arcade, we simply didn't know. A game, regardless of the level of "influence" from the original one, was taken as "good". We played *Munch-Man*, for example, and we didn't question whether it was a good or a bad game. It was just as good as the original *Pac-Man*.

But, deep inside, you felt that something was missing. The contrast wasn't only in the (much simpler albeit more than decent) graphics. Not even in the sound, that was very simple at the time (and,  for example, the Commodore-64's SID was more than capable to surpass many arcade games)

What ware missing ware the tiny technical details (planned or not) the rendered the gameplay unique. It wasn't unusual that hard-core players ended in knowing and mastering the game much better than the creators themselves.

Now that we know this, conceiving a faithful clone is quite a challenge. It might be simpler to develop an emulator for the original ROM.

How much I'd like to create a good *Bubble-Bobble* or *Rainbow Islands* clone. :-)

## Day #7 (2018-04-17)

Drawing sprites is hard for me. I'm definitely not a pixel-artist (at the moment, at least). I tried to draw some simple 16x16 sprites, but I end always in something far too similar to the originals. The best ones, so far, are the ghosts. I managed to change them slightly with nice results. But the main character is too "flat" to elaborate upon.

It hard to resist the temptation to browse through [OpenGameArt](https://opengameart.org/) and grab something nicer. :)

## Day #8 (2018-04-18)

I was finally drawing some satisfying sprites when, abruptly, I found the underlying problem. I wrongly assumed the original sprites were using the whole 16x16 call, while in fact they are 13x13 and 14x14 sized (respectively for Pac-Man and the ghosts). I was feeling like cheating when I was simply right in wanting to reduce (and make *odd*) the size of the characters. So, I reworked the sprites in all their 13x13 pixels opulence and they definitely are nicer. Here's a quick "before-vs-after" image to render the idea.

![Sprites (v0)](/assets/images/pacman-sprites-v0.png)

Now that the inspiration has been found, it's just a matter of finishing the sprite-sheet. I'm going to try and make the sprites "squarer" (no pun intended), perhaps the will look nicer. Also, it would be fun to make the tileset 4x4 and the sprites 8x8, anyway. Somewhat it would be like making a micro Pac-Man look-alike. :)

## Day #9 (2018-04-19)

At last! I completed the sprite-sheet! I'm pleased with the result, but I'll iterate and refine more the sprites along the way (I'm curious in trying GameBoy palettized colors, too). Here's a sneak-peek of the atlas.

![Sprites (v1)](/assets/images/pacman-sprites-v1.png)

Since I switched from the Pico-8 palette to more unsaturated pastel colors I need to fix the tileset, too. This won't be a hassle, however.

## Day #10 (2018-04-20)

Today I began examining how to manage the map. So far I've been solely drawing it with [Pyxel-Edit](http://pyxeledit.com/). It's time to plan the in-game representation. *Pyxel-Edit* exports both to JSON and plain text format. The first one is verbose, and while it carries a lot of detailed information it would require a lot of hacking to be converted into some usable internal representation. The second one is straight-forward. Guess I'll be writing a simple loader for the latter, then.

> I'm aware that [Tiled](http://www.mapeditor.org/) might be a valid alternative, with a format supported by [Simple-Tiled-Implementation](https://github.com/karai17/Simple-Tiled-Implementation). However, due to the scope of the project, it seems an abuse to me.

## Day #11/#12 (2018-04-21/22)

Two day-long design/programming session, without even touching the computer. That means, reasoning about things in the spare time while attending family duties. :)

Planned the assets and tilemap management modules. I'll try and keep them very simple and straightforward, without over-generalizing them (as my usual). However, I'd like them to be a bit more sophisticated than what is strictly expected.

## Day #13 (2018-04-23)

**All together now!**

![Mock-Up (v2)](/assets/images/pacman-mockup-v2.png)

The result is quite good but needs quite a bit of tweaking. The most relevant parts to be reworked are related to the maze corridors. I was trying to simplify the management, reducing the number of different tiles. Yet, this produces very narrow hallways due to the actor being somewhat *chubby*. I need to either make the maze a bit more spacey or reduce the actors' size. Will try this tomorrow.

In the meantime, I will also draw a Namco-inspired bitmap font. Gosh, how much I was always enamored with those monochrome fonts. They were essential in making those early masterpieces so special.

## Day #14/#15 (2018-04-24/25)

The mock-up served well to check the overall status of the graphical assets.

Reworked the sprite assets, as I prefer to keep the maze tile-set manageable and with a reduced amount of tiles. I chopped one row and one column from each actor (they are now 12x12 pixels sized). To better render the Pac-Man sprite, I steered it from the original shape making it squared in a similar way like to ghosts. Also, I gave it a pair of eyes.

![Mock-Up (v3)](/assets/images/pacman-mockup-v3.png)

I'm planning to make ghosts' eyes follow their target position. Also, when "dazed" they'll get some wacky eyes.

## Day #14 (2018-04-26)

Making the ghosts follow with the eye the current target cell requires each one of them to have *sixty-four* different sprites (*eight* eye-position *times* *two* movement images *times* *four* directions). That is going to be an overkill and insanely difficult to handle, expecially since the game being so simple. I need to switch to composite/stacked sprites, that is we will build the ghosts sprite by *composing* the single parts: body and eyes.

![Stacked Ghost Sprite](/assets/images/pacman-stacked-ghost-sprite.png)

Of course the animator is going to be more complicated (but not by a long shot) and will need to be carefully configured, but it's going to be versatile. More on this, tomorrow.

In the meantime I wrote the tile-map loader, that handles *Pyxel-Edit*'s plain-text format. With some clever regex (opps, pattern) usage, the parser can be implemented with ease.

```lua
local MATCHES = {
  ['^tileswide ([0-9]+)$'] = function(map, r)
                               map.width = tonumber(r)
                             end,
  ['^tileshigh ([0-9]+)$'] = function(map, r)
                               map.height = tonumber(r)
                             end,
  ['^tilewidth ([0-9]+)$'] = function(map, r)
                               map.tile_width = tonumber(r)
                             end,
  ['^tileheight ([0-9]+)$'] = function(map, r)
                                map.tile_height = tonumber(r)
                              end,
  ['^layer ([0-9]+ [%-0-9,]+)$'] = function(map, r)
                                    local layer_id, layer_data = string.match(r, "^([0-9]+) ([%-0-9,]+)$")
                                    local layer = {}
                                    for cell_id in layer_data:gmatch("(%-?[0-9]+),?") do
                                      layer[#layer + 1] = tonumber(cell_id)
                                    end
                                    if not map.layers then
                                      map.layers = {}
                                    end
                                    map.layers[tonumber(layer_id)] = layer
                                  end
}

function load_tile_map(name)
  local map = {}
  local accumulator = ""
  for line in love.filesystem.lines(name) do
    local parse = false
    if string.len(line) == 0 and string.len(accumulator) > 0 then
      parse = true
    elseif string.len(line) > 0 then
      accumulator = accumulator .. line
      if string.match(line, "^layer") then
        accumulator = accumulator .. " "
        parse = false
      elseif string.match(line, ",$") then
        parse = false
      else
        parse = true
      end
    end
    if parse then
      for regex, callback in pairs(MATCHES) do
        local result = string.match(accumulator, regex)
        if result then
          callback(map, result)
          break
        end
      end
      accumulator = ""
    end
  end
  return map
end
```

## Day #15 (2018-04-27)

*The best has yet to come...*
